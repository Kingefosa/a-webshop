/* CodeMirror - Minified & Bundled
   Generated on 2014-8-26 with http://codemirror.net/doc/compress.html
   Version: 4.5

   Add-ons:
   - merge.js
 */

!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function d(a,b){this.mv=a,this.type=b,this.classes="left"==b?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}function e(b){b.diffOutOfDate&&(b.diff=t(b.orig.getValue(),b.edit.getValue()),b.diffOutOfDate=!1,a.signal(b.edit,"updateDiff",b.diff))}function f(a){function f(d){"full"==d&&(a.svg&&A(a.svg),a.copyButtons&&A(a.copyButtons),k(a.edit,b.marked,a.classes),k(a.orig,c.marked,a.classes),b.from=b.to=c.from=c.to=0),e(a),a.showDifferences&&(l(a.edit,a.diff,b,DIFF_INSERT,a.classes),l(a.orig,a.diff,c,DIFF_DELETE,a.classes)),n(a)}function g(a){clearTimeout(d),d=setTimeout(f,1==a?250:100)}function h(){a.diffOutOfDate||(a.diffOutOfDate=!0,b.from=b.to=c.from=c.to=0),g(!0)}var d,b={from:0,to:0,marked:[]},c={from:0,to:0,marked:[]};return a.edit.on("change",h),a.orig.on("change",h),a.edit.on("markerAdded",g),a.edit.on("markerCleared",g),a.orig.on("markerAdded",g),a.orig.on("markerCleared",g),a.edit.on("viewportChange",g),a.orig.on("viewportChange",g),f(),f}function g(a){a.edit.on("scroll",function(){h(a,DIFF_INSERT)&&n(a)}),a.orig.on("scroll",function(){h(a,DIFF_DELETE)&&n(a)})}function h(a,b){if(a.diffOutOfDate)return!1;if(!a.lockScroll)return!0;var c,d,e=+new Date;if(b==DIFF_INSERT?(c=a.edit,d=a.orig):(c=a.orig,d=a.edit),c.state.scrollSetBy==a&&(c.state.scrollSetAt||0)+50>e)return!1;var p,q,f=c.getScrollInfo(),g=.5*f.clientHeight,h=f.top+g,j=c.lineAtHeight(h,"local"),k=y(a.diff,j,b==DIFF_INSERT),l=i(c,b==DIFF_INSERT?k.edit:k.orig),m=i(d,b==DIFF_INSERT?k.orig:k.edit),n=(h-l.top)/(l.bot-l.top),o=m.top-g+n*(m.bot-m.top);if(o>f.top&&(q=f.top/g)<1)o=o*q+f.top*(1-q);else if((p=f.height-f.clientHeight-f.top)<g){var r=d.getScrollInfo(),s=r.height-r.clientHeight-o;s>p&&(q=p/g)<1&&(o=o*q+(r.height-r.clientHeight-p)*(1-q))}return d.scrollTo(f.left,o),d.state.scrollSetAt=e,d.state.scrollSetBy=a,!0}function i(a,b){var c=b.after;return null==c&&(c=a.lastLine()+1),{top:a.heightAtLine(b.before||0,"local"),bot:a.heightAtLine(c,"local")}}function j(a,b,c){a.lockScroll=b,b&&0!=c&&h(a,DIFF_INSERT)&&n(a),a.lockButton.innerHTML=b?"\u21db\u21da":"\u21db&nbsp;&nbsp;\u21da"}function k(b,c,d){for(var e=0;e<c.length;++e){var f=c[e];f instanceof a.TextMarker?f.clear():f.parent&&(b.removeLineClass(f,"background",d.chunk),b.removeLineClass(f,"background",d.start),b.removeLineClass(f,"background",d.end))}c.length=0}function l(a,b,c,d,e){var f=a.getViewport();a.operation(function(){c.from==c.to||f.from-c.to>20||c.from-f.to>20?(k(a,c.marked,e),m(a,b,d,c.marked,f.from,f.to,e),c.from=f.from,c.to=f.to):(f.from<c.from&&(m(a,b,d,c.marked,f.from,c.from,e),c.from=f.from),f.to>c.to&&(m(a,b,d,c.marked,c.to,f.to,e),c.to=f.to))})}function m(a,c,d,e,f,g,h){function m(b,c){for(var d=Math.max(f,b),i=Math.min(g,c),j=d;i>j;++j){var k=a.addLineClass(j,"background",h.chunk);j==b&&a.addLineClass(k,"background",h.start),j==c-1&&a.addLineClass(k,"background",h.end),e.push(k)}b==c&&d==c&&i==c&&(d?e.push(a.addLineClass(d-1,"background",h.end)):e.push(a.addLineClass(d,"background",h.start)))}for(var i=b(0,0),j=b(f,0),k=a.clipPos(b(g-1)),l=d==DIFF_DELETE?h.del:h.insert,n=0,o=0;o<c.length;++o){var p=c[o],q=p[0],r=p[1];if(q==DIFF_EQUAL){var s=i.line+(x(c,o)?0:1);D(i,r);var t=i.line+(w(c,o)?1:0);t>s&&(o&&m(n,s),n=t)}else if(q==d){var u=D(i,r,!0),v=F(j,i),y=E(k,u);G(v,y)||e.push(a.markText(v,y,{className:l})),i=u}}n<=i.line&&m(n,i.line+1)}function n(a){if(a.showDifferences){if(a.svg){A(a.svg);var b=a.gap.offsetWidth;B(a.svg,"width",b,"height",a.gap.offsetHeight)}a.copyButtons&&A(a.copyButtons);var d="left"==a.type,e=a.edit.getViewport(),f=a.orig.getViewport(),g=a.edit.getScrollInfo().top,h=a.orig.getScrollInfo().top;u(a.diff,function(i,j,k,l){if(!(k>e.to||l<e.from||i>f.to||j<f.from)){var m=a.orig.heightAtLine(i,"local")-h,n=m;if(a.svg){var o=a.edit.heightAtLine(k,"local")-g;if(d){var p=m;m=o,o=p}var q=a.orig.heightAtLine(j,"local")-h,r=a.edit.heightAtLine(l,"local")-g;if(d){var p=q;q=r,r=p}var s=" C "+b/2+" "+o+" "+b/2+" "+m+" "+(b+2)+" "+m,t=" C "+b/2+" "+q+" "+b/2+" "+r+" -1 "+r;B(a.svg.appendChild(document.createElementNS(c,"path")),"d","M -1 "+o+s+" L "+(b+2)+" "+q+t+" z","class",a.classes.connect)}if(a.copyButtons){var u=a.copyButtons.appendChild(z("div","left"==a.type?"\u21dd":"\u21dc","CodeMirror-merge-copy")),v=a.mv.options.allowEditingOriginals;if(u.title=v?"Push to left":"Revert chunk",u.chunk={topEdit:k,botEdit:l,topOrig:i,botOrig:j},u.style.top=n+"px",v){var w=a.orig.heightAtLine(k,"local")-g,x=a.copyButtons.appendChild(z("div","right"==a.type?"\u21dd":"\u21dc","CodeMirror-merge-copy-reverse"));x.title="Push to right",x.chunk={topEdit:i,botEdit:j,topOrig:k,botOrig:l},x.style.top=w+"px","right"==a.type?x.style.left="2px":x.style.right="2px"}}}})}}function o(a,c,d,e){a.diffOutOfDate||c.replaceRange(d.getRange(b(e.topOrig,0),b(e.botOrig,0)),b(e.topEdit,0),b(e.botEdit,0))}function q(b){var d=b.lockButton=z("div",null,"CodeMirror-merge-scrolllock");d.title="Toggle locked scrolling";var e=z("div",[d],"CodeMirror-merge-scrolllock-wrap");a.on(d,"click",function(){j(b,!b.lockScroll)});var f=[e];b.mv.options.revertButtons!==!1&&(b.copyButtons=z("div",null,"CodeMirror-merge-copybuttons-"+b.type),a.on(b.copyButtons,"click",function(a){var c=a.target||a.srcElement;if(c.chunk)return"CodeMirror-merge-copy-reverse"==c.className?(o(b,b.orig,b.edit,c.chunk),void 0):(o(b,b.edit,b.orig,c.chunk),void 0)}),f.unshift(b.copyButtons));var g=document.createElementNS&&document.createElementNS(c,"svg");return g&&!g.createSVGRect&&(g=null),b.svg=g,g&&f.push(g),b.gap=z("div",f,"CodeMirror-merge-gap")}function r(a){return"string"==typeof a?a:a.getValue()}function t(a,b){var c=s.diff_main(a,b);s.diff_cleanupSemantic(c);for(var d=0;d<c.length;++d){var e=c[d];e[1]?d&&c[d-1][0]==e[0]&&(c.splice(d--,1),c[d][1]+=e[1]):c.splice(d--,1)}return c}function u(a,c){for(var d=0,e=0,f=b(0,0),g=b(0,0),h=0;h<a.length;++h){var i=a[h],j=i[0];if(j==DIFF_EQUAL){var k=x(a,h)?0:1,l=f.line+k,m=g.line+k;D(f,i[1],null,g);var n=w(a,h)?1:0,o=f.line+n,p=g.line+n;o>l&&(h&&c(e,m,d,l),d=o,e=p)}else D(j==DIFF_INSERT?f:g,i[1])}(d<=f.line||e<=g.line)&&c(e,g.line+1,d,f.line+1)}function v(a){e(a);var b=[];return u(a.diff,function(a,c,d,e){b.push({origFrom:a,origTo:c,editFrom:d,editTo:e})}),b}function w(a,b){if(b==a.length-1)return!0;var c=a[b+1][1];return 1==c.length||10!=c.charCodeAt(0)?!1:b==a.length-2?!0:(c=a[b+2][1],c.length>1&&10==c.charCodeAt(0))}function x(a,b){if(0==b)return!0;var c=a[b-1][1];return 10!=c.charCodeAt(c.length-1)?!1:1==b?!0:(c=a[b-2][1],10==c.charCodeAt(c.length-1))}function y(a,b,c){var d,e,f,g;return u(a,function(a,h,i,j){var k=c?i:a,l=c?j:h;null==e&&(k>b?(e=i,g=a):l>b&&(e=j,g=h)),b>=l?(d=j,f=h):b>=k&&(d=i,f=a)}),{edit:{before:d,after:e},orig:{before:f,after:g}}}function z(a,b,c,d){var e=document.createElement(a);if(c&&(e.className=c),d&&(e.style.cssText=d),"string"==typeof b)e.appendChild(document.createTextNode(b));else if(b)for(var f=0;f<b.length;++f)e.appendChild(b[f]);return e}function A(a){for(var b=a.childNodes.length;b>0;--b)a.removeChild(a.firstChild)}function B(a){for(var b=1;b<arguments.length;b+=2)a.setAttribute(arguments[b],arguments[b+1])}function C(a,b){b||(b={});for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function D(a,c,d,e){for(var f=d?b(a.line,a.ch):a,g=0;;){var h=c.indexOf("\n",g);if(-1==h)break;++f.line,e&&++e.line,g=h+1}return f.ch=(g?0:f.ch)+(c.length-g),e&&(e.ch=(g?0:e.ch)+(c.length-g)),f}function E(a,b){return(a.line-b.line||a.ch-b.ch)<0?a:b}function F(a,b){return(a.line-b.line||a.ch-b.ch)>0?a:b}function G(a,b){return a.line==b.line&&a.ch==b.ch}var b=a.Pos,c="http://www.w3.org/2000/svg";d.prototype={constructor:d,init:function(b,c,d){this.edit=this.mv.edit,this.orig=a(b,C({value:c,readOnly:!this.mv.options.allowEditingOriginals},C(d))),this.diff=t(r(c),r(d.value)),this.diffOutOfDate=!1,this.showDifferences=d.showDifferences!==!1,this.forceUpdate=f(this),j(this,!0,!1),g(this)},setShowDifferences:function(a){a=a!==!1,a!=this.showDifferences&&(this.showDifferences=a,this.forceUpdate("full"))}};var p=a.MergeView=function(b,c){if(!(this instanceof p))return new p(b,c);this.options=c;var e=c.origLeft,f=null==c.origRight?c.orig:c.origRight,g=null!=e,h=null!=f,i=1+(g?1:0)+(h?1:0),j=[],k=this.left=null,l=this.right=null;if(g){k=this.left=new d(this,"left");var m=z("div",null,"CodeMirror-merge-pane");j.push(m),j.push(q(k))}var o=z("div",null,"CodeMirror-merge-pane");if(j.push(o),h){l=this.right=new d(this,"right"),j.push(q(l));var r=z("div",null,"CodeMirror-merge-pane");j.push(r)}(h?r:o).className+=" CodeMirror-merge-pane-rightmost",j.push(z("div",null,null,"height: 0; clear: both;"));var s=this.wrap=b.appendChild(z("div",j,"CodeMirror-merge CodeMirror-merge-"+i+"pane"));this.edit=a(o,C(c)),k&&k.init(m,e,c),l&&l.init(r,f,c);var t=function(){k&&n(k),l&&n(l)};a.on(window,"resize",t);var u=setInterval(function(){for(var b=s.parentNode;b&&b!=document.body;b=b.parentNode);b||(clearInterval(u),a.off(window,"resize",t))},5e3)};p.prototype={constuctor:p,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(a){this.right&&this.right.setShowDifferences(a),this.left&&this.left.setShowDifferences(a)},rightChunks:function(){return this.right&&v(this.right)},leftChunks:function(){return this.left&&v(this.left)}};var s=new diff_match_patch});